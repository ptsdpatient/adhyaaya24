const $=new Set,d=new WeakMap,y=new WeakMap,v=new WeakMap,N=new WeakMap,k=new WeakMap,M=new WeakMap,T=new WeakMap,O=new WeakSet;let l;const g="__aa_tgt",W="__aa_del",j=t=>{const e=I(t);e&&e.forEach(i=>q(i))},R=t=>{t.forEach(e=>{e.target===l&&D(),d.has(e.target)&&b(e.target)})};function B(t){const e=N.get(t);e==null||e.disconnect();let i=d.get(t),o=0;const n=5;i||(i=E(t),d.set(t,i));const{offsetWidth:r,offsetHeight:s}=l,u=[i.top-n,r-(i.left+n+i.width),s-(i.top+n+i.height),i.left-n].map(p=>`${-1*Math.floor(p)}px`).join(" "),c=new IntersectionObserver(()=>{++o>1&&b(t)},{root:l,threshold:1,rootMargin:u});c.observe(t),N.set(t,c)}function b(t){clearTimeout(T.get(t));const e=x(t),i=typeof e=="function"?500:e.duration;T.set(t,setTimeout(async()=>{const o=v.get(t);(!o||await o.finished)&&(d.set(t,E(t)),B(t))},i))}function D(){clearTimeout(T.get(l)),T.set(l,setTimeout(()=>{$.forEach(t=>_(t,e=>z(()=>b(e))))},100))}function F(t){setTimeout(()=>{k.set(t,setInterval(()=>z(b.bind(null,t)),2e3))},Math.round(2e3*Math.random()))}function z(t){typeof requestIdleCallback=="function"?requestIdleCallback(()=>t()):requestAnimationFrame(()=>t())}let P,w;typeof window<"u"&&(l=document.documentElement,P=new MutationObserver(j),w=new ResizeObserver(R),w.observe(l));function I(t){return t.reduce((o,n)=>[...o,...Array.from(n.addedNodes),...Array.from(n.removedNodes)],[]).every(o=>o.nodeName==="#comment")?!1:t.reduce((o,n)=>{if(o===!1)return!1;if(n.target instanceof Element){if(C(n.target),!o.has(n.target)){o.add(n.target);for(let r=0;r<n.target.children.length;r++){const s=n.target.children.item(r);if(s){if(W in s)return!1;C(n.target,s),o.add(s)}}}if(n.removedNodes.length)for(let r=0;r<n.removedNodes.length;r++){const s=n.removedNodes[r];if(W in s)return!1;s instanceof Element&&(o.add(s),C(n.target,s),y.set(s,[n.previousSibling,n.nextSibling]))}}return o},new Set)}function C(t,e){!e&&!(g in t)?Object.defineProperty(t,g,{value:t}):e&&!(g in e)&&Object.defineProperty(e,g,{value:t})}function q(t){var e;const i=l.contains(t),o=d.has(t);i&&y.has(t)&&y.delete(t),v.has(t)&&((e=v.get(t))===null||e===void 0||e.cancel()),o&&i?X(t):o&&!i?H(t):Y(t)}function f(t){return Number(t.replace(/[^0-9.\-]/g,""))}function E(t){const e=t.getBoundingClientRect();return{top:e.top+window.scrollY,left:e.left+window.scrollX,width:e.width,height:e.height}}function A(t,e,i){let o=e.width,n=e.height,r=i.width,s=i.height;const a=getComputedStyle(t);if(a.getPropertyValue("box-sizing")==="content-box"){const c=f(a.paddingTop)+f(a.paddingBottom)+f(a.borderTopWidth)+f(a.borderBottomWidth),p=f(a.paddingLeft)+f(a.paddingRight)+f(a.borderRightWidth)+f(a.borderLeftWidth);o-=p,r-=p,n-=c,s-=c}return[o,r,n,s].map(Math.round)}function x(t){return g in t&&M.has(t[g])?M.get(t[g]):{duration:250,easing:"ease-in-out"}}function L(t){if(g in t)return t[g]}function S(t){const e=L(t);return e?O.has(e):!1}function _(t,...e){e.forEach(i=>i(t,M.has(t)));for(let i=0;i<t.children.length;i++){const o=t.children.item(i);o&&e.forEach(n=>n(o,M.has(o)))}}function X(t){const e=d.get(t),i=E(t);if(!S(t))return d.set(t,i);let o;if(!e)return;const n=x(t);if(typeof n!="function"){const r=e.left-i.left,s=e.top-i.top,[a,u,c,p]=A(t,e,i),h={transform:`translate(${r}px, ${s}px)`},m={transform:"translate(0, 0)"};a!==u&&(h.width=`${a}px`,m.width=`${u}px`),c!==p&&(h.height=`${c}px`,m.height=`${p}px`),o=t.animate([h,m],{duration:n.duration,easing:n.easing})}else o=new Animation(n(t,"remain",e,i)),o.play();v.set(t,o),d.set(t,i),o.addEventListener("finish",b.bind(null,t))}function Y(t){const e=E(t);d.set(t,e);const i=x(t);if(!S(t))return;let o;typeof i!="function"?o=t.animate([{transform:"scale(.98)",opacity:0},{transform:"scale(0.98)",opacity:0,offset:.5},{transform:"scale(1)",opacity:1}],{duration:i.duration*1.5,easing:"ease-in"}):(o=new Animation(i(t,"add",e)),o.play()),v.set(t,o),o.addEventListener("finish",b.bind(null,t))}function H(t){var e;if(!y.has(t)||!d.has(t))return;const[i,o]=y.get(t);Object.defineProperty(t,W,{value:!0}),o&&o.parentNode&&o.parentNode instanceof Element?o.parentNode.insertBefore(t,o):i&&i.parentNode?i.parentNode.appendChild(t):(e=L(t))===null||e===void 0||e.appendChild(t);function n(){var m;t.remove(),d.delete(t),y.delete(t),v.delete(t),(m=N.get(t))===null||m===void 0||m.disconnect()}if(!S(t))return n();const[r,s,a,u]=Q(t),c=x(t),p=d.get(t);let h;Object.assign(t.style,{position:"absolute",top:`${r}px`,left:`${s}px`,width:`${a}px`,height:`${u}px`,margin:0,pointerEvents:"none",transformOrigin:"center",zIndex:100}),typeof c!="function"?h=t.animate([{transform:"scale(1)",opacity:1},{transform:"scale(.98)",opacity:0}],{duration:c.duration,easing:"ease-out"}):(h=new Animation(c(t,"remove",p)),h.play()),v.set(t,h),h.addEventListener("finish",n)}function Q(t){const e=d.get(t),[i,,o]=A(t,e,E(t));let n=t.parentElement;for(;n&&(getComputedStyle(n).position==="static"||n instanceof HTMLBodyElement);)n=n.parentElement;n||(n=document.body);const r=getComputedStyle(n),s=d.get(n)||E(n),a=Math.round(e.top-s.top)-f(r.borderTopWidth),u=Math.round(e.left-s.left)-f(r.borderLeftWidth);return[a,u,i,o]}function U(t,e={}){return P&&w&&(window.matchMedia("(prefers-reduced-motion: reduce)").matches&&typeof e!="function"&&!e.disrespectUserMotionPreference||(O.add(t),getComputedStyle(t).position==="static"&&Object.assign(t.style,{position:"relative"}),_(t,b,F,n=>w==null?void 0:w.observe(n)),typeof e=="function"?M.set(t,e):M.set(t,{duration:250,easing:"ease-in-out",...e}),P.observe(t,{childList:!0}),$.add(t))),Object.freeze({parent:t,enable:()=>{O.add(t)},disable:()=>{O.delete(t)},isEnabled:()=>O.has(t)})}export{U as a};
